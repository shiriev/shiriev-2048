(this["webpackJsonpshiriev-2048"]=this["webpackJsonpshiriev-2048"]||[]).push([[0],[,,,,,,,,,,,function(e,t,n){e.exports=n(25)},,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),o=n(10),r=(n(16),n(6)),c=n(7),l=(n(17),n(27)),s=n(1),u=n(2);n(18),n(19);function f(e){var t=e.cell,n=t.value,i=t.position,o={"--position-x":i.x,"--position-y":i.y};return a.a.createElement("div",{style:o,className:"block block_value_".concat(n)},a.a.createElement("span",{className:"block__text block__text_digits-count_".concat(n.toString().length)},n||null))}var h=function e(){Object(s.a)(this,e)},m=n(4),v=n(3),p=n(5),d=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this))).cell=void 0,n.cell=e,n}return Object(p.a)(t,e),Object(u.a)(t,[{key:"clone",value:function(){return new t(this.cell.clone())}}]),t}(h),b=function(e){function t(){return Object(s.a)(this,t),Object(m.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(u.a)(t,[{key:"clone",value:function(){return new t}}]),t}(h),w=function(e){function t(e,n,i){var a;return Object(s.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this))).firstCell=void 0,a.secondCell=void 0,a.newCell=void 0,a.firstCell=e,a.secondCell=n,a.newCell=i,a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"clone",value:function(){return new t(this.firstCell.clone(),this.secondCell.clone(),this.newCell.clone())}}]),t}(h),y=function(e){function t(e,n,i){var a;return Object(s.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this))).value=void 0,a.oldPosition=void 0,a.newPosition=void 0,a.value=e,a.oldPosition=n,a.newPosition=i,a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"clone",value:function(){return new t(this.value,this.oldPosition.clone(),this.newPosition.clone())}}]),t}(h),_=function(e){function t(){return Object(s.a)(this,t),Object(m.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(u.a)(t,[{key:"clone",value:function(){return new t}}]),t}(h),O=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this))).cells=void 0,n.cells=e,n}return Object(p.a)(t,e),Object(u.a)(t,[{key:"clone",value:function(){return new t(this.cells)}}]),t}(h),j=function(){function e(t,n){Object(s.a)(this,e),this.cell=void 0,this.id=void 0,this.cell=t,this.id=n}return Object(u.a)(e,[{key:"clone",value:function(){return new e(this.cell.clone(),this.id)}}]),e}();function g(e){var t=e.mapAnimationParams,n=e.mapDimension;return a.a.createElement("div",{className:"map",style:{"--map-dimension":n}},t.cells.map((function(e){return a.a.createElement(f,{key:e.id,cell:e.cell})})))}n(20);function k(e){var t=e.title,n=e.value;return a.a.createElement("div",{className:"counter"},a.a.createElement("div",{className:"counter__title"},t),a.a.createElement("div",{className:"counter__value"},n))}n(21);function E(e){return a.a.createElement("div",{className:"modal"},a.a.createElement("div",{className:"modal__content"},a.a.createElement("h1",{className:"modal__title"},e.title),e.children))}n(22);function C(e){return a.a.createElement("div",{className:"button",onClick:e.onClick},e.title)}n(23);function D(e){var t=e.children,n=e.link;return a.a.createElement("h1",{className:"title"},a.a.createElement("a",{href:n},t))}var x;n(24);function N(e){var t=e.children;return a.a.createElement("div",{className:"tool"},t)}function A(e){var t=e.children;return a.a.createElement("div",{className:"toolbar"},t)}!function(e){e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.Left=2]="Left",e[e.Right=3]="Right"}(x||(x={}));var R=x,P=function(){function e(t,n){Object(s.a)(this,e),this.x=0,this.y=0,this.x=t,this.y=n}return Object(u.a)(e,[{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"clone",value:function(){return new e(this.x,this.y)}}]),e}(),L=function(){function e(t,n){Object(s.a)(this,e),this.value=void 0,this.position=void 0,this.value=t,this.position=n}return Object(u.a)(e,[{key:"clone",value:function(){return new e(this.value,this.position.clone())}}]),e}(),M=function e(){Object(s.a)(this,e),this.cells=[],this.score=0,this.stepCount=0,this.mapDimension=0},S=function(){function e(t,n){if(Object(s.a)(this,e),this._cells=[],this._actions=[],this._score=0,this._stepCount=0,this._mapDimension=void 0,this._randomize=void 0,t<2)throw new RangeError("mapDimension shouldn`t be lower than 2");if(!n)throw new TypeError("randomize shouldn`t be null");this._mapDimension=t,this._randomize=n}return Object(u.a)(e,[{key:"load",value:function(e){return this._actions=[],this._cells=e.cells,this._mapDimension=e.mapDimension,this._score=e.score,this._stepCount=e.stepCount,[new O(e.cells)]}},{key:"save",value:function(){var e=new M;return e.cells=this._cells.map((function(e){return e.clone()})),e.mapDimension=this.mapDimension,e.score=this._score,e.stepCount=this._stepCount,e}},{key:"restart",value:function(){this._cells=[],this._score=0,this._stepCount=0;var e=new _;return this._actions.push(e),[e]}},{key:"canDoMove",value:function(){if(this._cells.length<this.mapDimension*this.mapDimension)return!0;for(var e=this.matrix,t=0;t<e.length;t++)for(var n=0;n<e.length-1;n++)if(e[t][n]===e[t][n+1]||e[n][t]===e[n+1][t])return!0;return!1}},{key:"getPointTransform",value:function(e,t){switch(t){case R.Left:return{from:function(e){return e},to:function(e){return e}};case R.Right:return{from:function(t){return new P(e-t.x-1,t.y)},to:function(t){return new P(e-t.x-1,t.y)}};case R.Up:return{from:function(e){return new P(e.y,e.x)},to:function(e){return new P(e.y,e.x)}};case R.Down:return{from:function(t){return new P(e-t.y-1,t.x)},to:function(t){return new P(t.y,e-t.x-1)}}}}},{key:"dropCell",value:function(e){this._cells.splice(this._cells.indexOf(e),1)}},{key:"move",value:function(e){for(var t,n=this,i=[],a=this.getPointTransform(this.mapDimension,e),o=a.from,c=a.to,l=function(e){for(var t=n._cells.filter((function(t){return o(t.position).y===e})).sort((function(e,t){return o(e.position).x-o(t.position).x})),a=0,r=0;r<t.length;r++){var l=t[r],s=r+1<t.length?t[r+1]:null;if(null!==s&&l.value===s.value){n.dropCell(l),n.dropCell(s);var u=2*l.value,f=new L(u,c(new P(a,e)));n._cells.push(f);var h=new w(l,s,f);i.push(h),n._score+=u,r++}else if(a<o(l.position).x){var m=l.position.clone();l.position=c(new P(a,o(l.position).y));var v=l.position.clone(),p=new y(l.value,m,v);i.push(p)}a++}},s=0;s<this.mapDimension;s++)l(s);if(i.length<=0)return[];this._stepCount++,(t=this._actions).push.apply(t,i);var u=this.addCell();return i.push.apply(i,Object(r.a)(u)),this.canDoMove()||i.push(new b),i}},{key:"addCell",value:function(){for(var e=this,t=function(){var t=e._randomize.getRandomPosition(e.mapDimension);if(!e._cells.some((function(e){return e.position.equals(t)}))){var n=e._randomize.getRandomCellValue(),i=new L(n,t);e._cells.push(i);var a=new d(i);return e._actions.push(a),{v:[a]}}};;){var n=t();if("object"===typeof n)return n.v}}},{key:"matrix",get:function(){var e=this,t=Array(this.mapDimension).fill([]).map((function(){return Array(e.mapDimension).fill(0)})),n=!0,i=!1,a=void 0;try{for(var o,r=this._cells[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){var c=o.value;t[c.position.y][c.position.x]=c.value}}catch(l){i=!0,a=l}finally{try{n||null==r.return||r.return()}finally{if(i)throw a}}return t}},{key:"score",get:function(){return this._score}},{key:"stepCount",get:function(){return this._stepCount}},{key:"maxValue",get:function(){return this._cells.length>0?Math.max.apply(Math,Object(r.a)(this._cells.map((function(e){return e.value})))):0}},{key:"mapDimension",get:function(){return this._mapDimension}},{key:"isEnd",get:function(){return!this.canDoMove()}}]),e}(),I=function(){function e(){Object(s.a)(this,e)}return Object(u.a)(e,[{key:"getRandomPosition",value:function(e){return new P(this.getRandomIntInclusive(0,e-1),this.getRandomIntInclusive(0,e-1))}},{key:"getRandomCellValue",value:function(){return this.getRandomIntInclusive(0,10)>0?2:4}},{key:"getRandomIntInclusive",value:function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}}]),e}(),T=function(e,t){U(e),z(e,t)},U=function(e){Object(i.useEffect)((function(){var t=function(t){var n;switch(t.key){case"ArrowUp":n=R.Up;break;case"ArrowDown":n=R.Down;break;case"ArrowLeft":n=R.Left;break;case"ArrowRight":n=R.Right;break;default:return}e(n)};return document.addEventListener("keydown",t,!1),function(){return document.removeEventListener("keydown",t,!1)}}),[e])},z=function(e,t){Object(i.useEffect)((function(){var n=t.current;if(n){var i=null,a=null,o=function(e){i=e.touches[0].clientX,a=e.touches[0].clientY},r=function(t){if(i&&a){var n=t.touches[0].clientX,o=t.touches[0].clientY,r=i-n,c=a-o;Math.abs(r)>Math.abs(c)?e(r>0?R.Left:R.Right):e(c>0?R.Up:R.Down),i=null,a=null}};return n.addEventListener("touchstart",o,!1),n.addEventListener("touchmove",r,!1),function(){n.removeEventListener("touchstart",o,!1),n.removeEventListener("touchmove",r,!1)}}}),[e,t])},W=function(e){Object(i.useEffect)((function(){var t=function(t){return e(),!1};return window.addEventListener("unload",t),function(){window.removeEventListener("unload",t,!1)}}),[e])},Y={en:{restart:"new game",score:"score",stepCount:"moves",gameOver:"Game over",doYouWantToTryAgain:"Do you want to try again?"},ru:{restart:"\u0440\u0435\u0441\u0442\u0430\u0440\u0442",score:"\u043e\u0447\u043a\u0438",stepCount:"\u0445\u043e\u0434\u044b",gameOver:"\u0418\u0433\u0440\u0430 \u043e\u043a\u043e\u043d\u0447\u0435\u043d\u0430",doYouWantToTryAgain:"\u0425\u043e\u0442\u0438\u0442\u0435 \u0441\u044b\u0433\u0440\u0430\u0442\u044c \u0435\u0449\u0451?"}},q=4,V=2,B=function(){var e=Object(l.a)(["AppCookie"]),t=Object(c.a)(e,2),n=t[0],i=t[1],a=n.AppCookie||null;a&&(a.logicState.cells=a.logicState.cells.map((function(e){return new L(e.value,new P(e.position.x,e.position.y))})));return[a,function(e){return i("AppCookie",e)}]};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.render(i.createElement((function(){var e=B(),t=Object(c.a)(e,2),n=t[0],o=t[1],l=Object(i.useState)(null),s=Object(c.a)(l,2),u=s[0],f=s[1],h=Object(i.useRef)(null),m=function(){var e=Object(i.useRef)([]),t=Object(i.useRef)(0),n=Object(i.useState)([]),a=Object(c.a)(n,2),o=a[0],l=a[1],s=Object(i.useCallback)((function(e,t){var n=e.find((function(e){return e.cell.position.equals(t)}));if(void 0===n)throw new Error("");return n}),[]);return{mapAnimationParams:{cells:o},sendActions:Object(i.useCallback)((function(n){var i=Object(r.a)(e.current),a=!0,o=!1,c=void 0;try{for(var u,f=n[Symbol.iterator]();!(a=(u=f.next()).done);a=!0){var h=u.value;if(h instanceof d)i.push(new j(h.cell.clone(),t.current++));else if(h instanceof y){s(e.current,h.oldPosition).cell.position=h.newPosition.clone()}else if(h instanceof w){var m=s(e.current,h.firstCell.position);s(e.current,h.secondCell.position).cell=h.newCell.clone(),i.splice(i.indexOf(m),1)}else h instanceof _?i.length=0:h instanceof O&&(i=h.cells.map((function(e){return new j(e.clone(),t.current++)})))}}catch(v){o=!0,c=v}finally{try{a||null==f.return||f.return()}finally{if(o)throw c}}e.current=i,l(e.current)}),[s])}}(),v=m.mapAnimationParams,p=m.sendActions,b=Object(i.useState)("en"),x=Object(c.a)(b,2),R=x[0],P=x[1],L=Y[R];Object(i.useEffect)((function(){if(P(n?n.language:"en"),n){var e=new S(q,new I),t=e.load(n.logicState);f(e),p(t)}else{for(var i=new S(q,new I),a=[],o=0;o<V;o++){var c=i.addCell();a.push.apply(a,Object(r.a)(c))}f(i),p(a)}}),[p,n]);var M=function(){if(null!==u){for(var e=u.restart(),t=0;t<V;t++){var n=u.addCell();e.push.apply(e,Object(r.a)(n))}p(e)}};return T((function(e){if(null!==u){var t=u.move(e);p(t)}}),h),W((function(){u&&o({language:R,logicState:u.save()})})),u&&a.a.createElement("div",{className:"app"},a.a.createElement("div",{ref:h,className:"app__map"},a.a.createElement(g,{mapDimension:u.mapDimension,mapAnimationParams:v})),a.a.createElement("div",{className:"app__title"},a.a.createElement(D,{link:"https://github.com/shiriev/shiriev-2048/"},"2048")),a.a.createElement("div",{className:"app__score"},a.a.createElement(k,{title:L.score,value:u.score})),a.a.createElement("div",{className:"app__step-count"},a.a.createElement(k,{title:L.stepCount,value:u.stepCount})),a.a.createElement("div",{className:"app__restart-button"},a.a.createElement(C,{title:L.restart,onClick:M})),a.a.createElement("div",{className:"app__language-bar"},a.a.createElement(A,null,a.a.createElement(N,null,a.a.createElement("div",{className:"app__language-link",onClick:function(){return P("en")}},"en")),a.a.createElement(N,null,a.a.createElement("div",{className:"app__language-link",onClick:function(){return P("ru")}},"ru")))),u.isEnd&&a.a.createElement(E,{title:L.gameOver},a.a.createElement("p",null,L.doYouWantToTryAgain),a.a.createElement(C,{title:L.restart,onClick:M})))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}],[[11,1,2]]]);
//# sourceMappingURL=main.db233a59.chunk.js.map